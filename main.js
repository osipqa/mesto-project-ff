(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-2",headers:{authorization:"637888a1-9ced-4570-b92f-3c1ad708077b","Content-Type":"application/json"}};function t(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST";return fetch("".concat(e.baseUrl).concat(t),{method:r,headers:e.headers,body:JSON.stringify(n)}).then((function(e){return e.json()})).catch((function(e){return Promise.reject("Error: ".concat(e.status))}))}var n=document.querySelector("#card-template").content.querySelector(".places__item");function r(e,t,r,o,c){var u=n.cloneNode(!0),i=u.querySelector(".card__delete-button"),l=u.querySelector(".card__image"),s=u.querySelector(".card__title"),d=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-count");return l.src=e.link,s.alt=e.name,s.textContent=e.name,p.textContent=e.likes.length,l.addEventListener("click",(function(){return r(e)})),d.addEventListener("click",(function(){return o(e,c,u)})),u.id=e._id,i.remove(),a(e,c)?d.classList.add("card__like-button_is-active"):d.classList.remove("card__like-button_is-active"),u}function o(e,n,r){var o,i=r.querySelector(".card__like-button"),l=r.querySelector(".card__like-count");a(e,n)?(o=e,t("/cards/likes/".concat(o._id),{},"DELETE")).then((function(t){c(t,i,l),e.likes=t.likes})).catch(u):function(e){return t("/cards/likes/".concat(e._id),{},"PUT")}(e).then((function(t){c(t,i,l),e.likes=t.likes})).catch(u)}function c(e,t,n){t.classList.toggle("card__like-button_is-active"),n.textContent=e.likes.length}function u(e){console.log("Error message: ".concat(e))}function a(e,t){return e.likes.some((function(e){return e._id===t}))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",s)}function l(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",s)}function s(e){"Escape"===e.code&&l(document.querySelector(".popup_is-opened"))}var d=function(e){return e.some((function(e){return!e.validity.valid}))};function p(e,t,n){var r=n.inputErrorClass,o=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),c.classList.remove(o),c.textContent=""}function _(e,t,n){d(e)?(t.disabled=!0,t.classList.add(n.inactiveButtonClass)):(t.disabled=!1,t.classList.remove(n.inactiveButtonClass))}function f(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){p(e,n,t)})),_(n,r,t)}var m=document.querySelector(".places__list"),v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__image"),h=document.querySelector(".popup__avatar"),q=document.getElementById("link-avatar-input"),b=document.querySelector(".popup_delete-image"),E=b.querySelector(".popup__button"),k=h.querySelector(".popup__button"),C=document.querySelector(".popup_type_new-card"),g=document.querySelector(".popup_type_image"),L=g.querySelector(".popup__image"),x=document.querySelector(".popup__caption"),T=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),P=document.querySelector(".popup_type_edit"),j=P.querySelector(".popup__button"),B=P.querySelector(".popup__form"),D=B.querySelector(".popup__input_type_name"),w=B.querySelector(".popup__input_type_description"),I=document.querySelectorAll(".popup"),U=C.querySelector(".popup__button"),M=C.querySelector(".popup__input_type_card-name"),G=C.querySelector(".popup__input_type_url"),H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function N(e){L.alt=e.name,x.textContent=e.name,L.src=e.link,i(g)}function O(e,t){t.textContent=e?"Сохранение...":t.dataset.buttonText}I.forEach((function(e){e.addEventListener("mouseup",(function(t){var n=t.target,r=t.currentTarget;(n.classList.contains("popup__close")||n===r)&&l(e)}))})),Promise.all([("/users/me",fetch("".concat(e.baseUrl).concat("/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){return Promise.reject("Error: ".concat(e.status))}))),fetch("".concat(e.baseUrl).concat("/cards"),{method:"GET",headers:e.headers}).then((function(e){return e.json()})).catch((function(e){return Promise.reject("Error: ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1].filter((function(e){return e.owner._id===t._id}));T.textContent=e[0].name,A.textContent=e[0].about,S.style="background-image: url('".concat(e[0].avatar,"')"),n.forEach((function(e){return m.append(r(e,0,N,o,t._id))}))})).catch((function(e){return Promise.reject("Error: ".concat(e.status))})),v.addEventListener("click",(function(){D.value=T.textContent,w.value=A.textContent,f(P,H),i(P)})),y.addEventListener("click",(function(){f(C,H),i(C)})),S.addEventListener("click",(function(){q.value="",f(h,H),i(h)})),C.addEventListener("submit",(function(e){var n,c;e.preventDefault(),O(!0,U),(n=M.value,c=G.value,t("/cards",{name:n,link:c})).then((function(e){m.append(r(e,0,N,o,ID))})).catch((function(e){return console.log(e)})).finally((function(){O(!1,U),l(C)})),C.querySelector(".popup__form").reset()})),B.addEventListener("submit",(function(e){e.preventDefault(),O(!0,j),T.textContent=D.value,A.textContent=w.value,function(e,n){return t("/users/me",{name:e,about:n},"PATCH")}(D.value,w.value).then((function(e){e&&e.name&&e.about&&(T.textContent=e.name,A.textContent=e.about)})).catch((function(e){return console.log(e)})).finally((function(){O(!1,j),l(P)}))})),h.addEventListener("submit",(function(e){var n;e.preventDefault(),O(!0,k),(n=q.value,t("/users/me/avatar",{avatar:n},"PATCH")).then((function(e){S.style="background-image: url('".concat(e.avatar,"')")})).catch((function(e){return console.log(e)})).finally((function(){O(!1,k),l(h)}))})),E.addEventListener("click",(function(e){e.preventDefault(),O(!0,E);var n,r=E.dataset.cardId;(n=r,t("/cards/".concat(n),{},"DELETE")).then((function(){var e=document.getElementById(r);e&&(e.remove(),E.dataset.cardId="",O(!1,E),l(b))})).catch((function(e){return console.log(e)}))})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n):function(e,t,n,r){var o=r.inputErrorClass,c=r.errorClass,u=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),u.classList.add(c),u.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),_(n,r,t)}))}))}(t,e)}))}(H)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aS5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL2NvbXBvbmVudHMvY2FyZC5qcyIsIndlYnBhY2s6Ly9tZXN0by1wcm9qZWN0LWZmLy4vc3JjL2NvbXBvbmVudHMvbW9kYWwuanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9jb21wb25lbnRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vbWVzdG8tcHJvamVjdC1mZi8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjb25maWcgPSB7XHJcbiAgYmFzZVVybDogJ2h0dHBzOi8vbm9tb3JlcGFydGllcy5jby92MS93ZmYtY29ob3J0LTInLFxyXG4gIGhlYWRlcnM6IHtcclxuICAgIGF1dGhvcml6YXRpb246ICc2Mzc4ODhhMS05Y2VkLTQ1NzAtYjkyZi0zYzFhZDcwODA3N2InLFxyXG4gICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEluZm8oZGF0YSkge1xyXG4gIHJldHVybiBmZXRjaChgJHtjb25maWcuYmFzZVVybH0ke2RhdGF9YCwge1xyXG4gICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgaGVhZGVyczogY29uZmlnLmhlYWRlcnMsXHJcbiAgfSlcclxuICAudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcclxuICAuY2F0Y2goKGVycikgPT4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke2Vyci5zdGF0dXN9YCkpXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYXJkcyhkYXRhKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2NvbmZpZy5iYXNlVXJsfSR7ZGF0YX1gLCB7XHJcbiAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICB9KVxyXG4gIC50aGVuKHJlcyA9PiByZXMuanNvbigpKVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7ZXJyLnN0YXR1c31gKSlcclxufVxyXG5cclxuZnVuY3Rpb24gcG9zdCh1c2VycywgZGF0YSwgbWV0aG9kID0gXCJQT1NUXCIpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7Y29uZmlnLmJhc2VVcmx9JHt1c2Vyc31gLCB7XHJcbiAgICBtZXRob2QsXHJcbiAgICBoZWFkZXJzOiBjb25maWcuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxyXG4gIH0pXHJcbiAgLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXHJcbiAgLmNhdGNoKChlcnIpID0+IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtlcnIuc3RhdHVzfWApKVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9DaGFuZ2VOYW1lcyhpbnB1dE5hbWUsIGlucHV0RGVzY3JpcHRpb24pIHtcclxuICByZXR1cm4gcG9zdChcIi91c2Vycy9tZVwiLCB7IG5hbWU6IGlucHV0TmFtZSwgYWJvdXQ6IGlucHV0RGVzY3JpcHRpb259LCBcIlBBVENIXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gdG9DaGFuZ2VBdmF0YXIoYXZhdGFyTGluaykge1xyXG4gIHJldHVybiBwb3N0KFwiL3VzZXJzL21lL2F2YXRhclwiLCB7IGF2YXRhcjogYXZhdGFyTGluayB9LCBcIlBBVENIXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkQ2FyZHMoZGF0YU5hbWUsIGRhdGFMaW5rKSB7XHJcbiAgcmV0dXJuIHBvc3QoXCIvY2FyZHNcIiwgeyBuYW1lOiBkYXRhTmFtZSwgbGluazogZGF0YUxpbmt9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlbGV0ZUNhcmRzKGNhcmRJZCkge1xyXG4gIHJldHVybiBwb3N0KGAvY2FyZHMvJHtjYXJkSWR9YCwge30sIFwiREVMRVRFXCIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlTGlrZShkYXRhKSB7XHJcbiAgcmV0dXJuIHBvc3QoYC9jYXJkcy9saWtlcy8ke2RhdGFbJ19pZCddfWAsIHt9LCBcIkRFTEVURVwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZExpa2UoZGF0YSkge1xyXG4gIHJldHVybiBwb3N0KGAvY2FyZHMvbGlrZXMvJHtkYXRhWydfaWQnXX1gLCB7fSwgXCJQVVRcIik7XHJcbn0iLCJpbXBvcnQgeyBhZGRMaWtlLCBkZWxldGVMaWtlIH0gZnJvbSBcIi4vYXBpXCI7XHJcbmV4cG9ydCB7IGNyZWF0ZUNhcmQsIGhhbmRsZUxpa2UgfTtcclxuXHJcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjYXJkLXRlbXBsYXRlJykuY29udGVudC5xdWVyeVNlbGVjdG9yKCcucGxhY2VzX19pdGVtJyk7XHJcblxyXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEsIHJlbW92ZUNhcmQsIG9wZW5JbWcsIGhhbmRsZUxpa2UsIElEKSB7XHJcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fZGVsZXRlLWJ1dHRvbicpO1xyXG4gIGNvbnN0IGNhcmRJbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19pbWFnZScpO1xyXG4gIGNvbnN0IGNhcmRUaXRsZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX190aXRsZScpO1xyXG4gIGNvbnN0IGNhcmRMaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgY29uc3QgY2FyZExpa2VDb3VudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jYXJkX19saWtlLWNvdW50Jyk7XHJcbiAgY2FyZEltYWdlLnNyYyA9IGRhdGEubGluaztcclxuICBjYXJkVGl0bGUuYWx0ID0gZGF0YS5uYW1lO1xyXG4gIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICBjYXJkTGlrZUNvdW50LnRleHRDb250ZW50ID0gZGF0YS5saWtlcy5sZW5ndGg7XHJcbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gb3BlbkltZyhkYXRhKSk7XHJcbiAgY2FyZExpa2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBoYW5kbGVMaWtlKGRhdGEsIElELCBjYXJkRWxlbWVudCkpO1xyXG4gIGNhcmRFbGVtZW50LmlkID0gZGF0YVsnX2lkJ107XHJcbiAgY2FyZERlbGV0ZUJ1dHRvbi5yZW1vdmUoKTtcclxuICBpZiAoY2hlY2soZGF0YSwgSUQpKSB7XHJcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKCdjYXJkX19saWtlLWJ1dHRvbl9pcy1hY3RpdmUnKTtcclxuICB9IGVsc2Uge1xyXG4gICAgY2FyZExpa2VCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgfVxyXG4gIHJldHVybiBjYXJkRWxlbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZShjYXJkLCBJRCwgY2FyZEVsZW1lbnQpIHtcclxuICBjb25zdCBidXR0b25MaWtlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcignLmNhcmRfX2xpa2UtYnV0dG9uJyk7XHJcbiAgY29uc3QgYnV0dG9uQ291bnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcuY2FyZF9fbGlrZS1jb3VudCcpXHJcbiAgaWYgKGNoZWNrKGNhcmQsIElEKSkge1xyXG4gICAgZGVsZXRlTGlrZShjYXJkKVxyXG4gICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgaGFuZGxlTGlrZVN1Y2Nlc3MocmVzLCBidXR0b25MaWtlLCBidXR0b25Db3VudCk7XHJcbiAgICAgICAgY2FyZC5saWtlcyA9IHJlcy5saWtlcztcclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGhhbmRsZUxpa2VFcnJvcik7XHJcbiAgfSBlbHNlIHtcclxuICAgIGFkZExpa2UoY2FyZClcclxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgIGhhbmRsZUxpa2VTdWNjZXNzKHJlcywgYnV0dG9uTGlrZSwgYnV0dG9uQ291bnQpO1xyXG4gICAgICAgIGNhcmQubGlrZXMgPSByZXMubGlrZXM7XHJcbiAgICAgIH0pXHJcbiAgICAgIC5jYXRjaChoYW5kbGVMaWtlRXJyb3IpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlTGlrZVN1Y2Nlc3MocmVzLCBidXR0b25MaWtlLCBidXR0b25Db3VudCkge1xyXG4gIGJ1dHRvbkxpa2UuY2xhc3NMaXN0LnRvZ2dsZSgnY2FyZF9fbGlrZS1idXR0b25faXMtYWN0aXZlJyk7XHJcbiAgYnV0dG9uQ291bnQudGV4dENvbnRlbnQgPSByZXMubGlrZXMubGVuZ3RoO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVMaWtlRXJyb3IoZXJyKSB7XHJcbiAgY29uc29sZS5sb2coYEVycm9yIG1lc3NhZ2U6ICR7ZXJyfWApO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVjayhkYXRhLCBJRCkge1xyXG4gIHJldHVybiBkYXRhLmxpa2VzLnNvbWUoKGkpID0+IGlbJ19pZCddID09PSBJRCk7XHJcbn0iLCJleHBvcnQgeyBvcGVuTW9kYWwsIGNsb3NlTW9kYWwgfTtcclxuXHJcbmZ1bmN0aW9uIG9wZW5Nb2RhbChwb3B1cCkge1xyXG4gIHBvcHVwLmNsYXNzTGlzdC5hZGQoJ3BvcHVwX2lzLW9wZW5lZCcpO1xyXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBjbG9zZUVzYyk7IC8vIElmIGRvbid0IHJlbW92ZSB0aGUgZXZlbnRsaXN0ZW5lciBmcm9tIGNsb3NlTW9kYWwsIGFuIGVycm9yIHdpbGwgb2NjdXIuXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwocG9wdXApIHsgLy8gV2l0aG91dCAnc2V0VGltZW91dCcsIGl0IGJlY2FtZSByZWFsbHkgc2FkIGhlcmUuIDpjXHJcbiAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgncG9wdXBfaXMtb3BlbmVkJyk7XHJcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGNsb3NlRXNjKTsgLy8gXCJUaGlzIHBpZWNlIG9mIGNvZGUgZml4ZXMgdGhhdC5cIlxyXG59XHJcblxyXG5mdW5jdGlvbiBjbG9zZUVzYyhldnQpIHtcclxuICBldnQuY29kZSA9PT0gJ0VzY2FwZScgJiYgY2xvc2VNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfaXMtb3BlbmVkJykpO1xyXG59IiwiY29uc3QgY2hlY2tWYWxpZCA9IChpbnB1dExpc3QpID0+IGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4gIWlucHV0LnZhbGlkaXR5LnZhbGlkKTtcclxuXHJcbmZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGVycm9yTWVzc2FnZSwgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSkge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKGVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgeyBpbnB1dEVycm9yQ2xhc3MsIGVycm9yQ2xhc3MgfSkge1xyXG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcclxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGVycm9yQ2xhc3MpO1xyXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9ICcnO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc1ZhbGlkKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpIHtcclxuICBpZiAoaW5wdXRFbGVtZW50LnZhbGlkaXR5LnBhdHRlcm5NaXNtYXRjaCkge1xyXG4gICAgaW5wdXRFbGVtZW50LnNldEN1c3RvbVZhbGlkaXR5KGlucHV0RWxlbWVudC5kYXRhc2V0LmVycm9yTWVzc2FnZSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGlucHV0RWxlbWVudC5zZXRDdXN0b21WYWxpZGl0eSgnJyk7XHJcbiAgfVxyXG4gIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbGVtZW50LCB2YWxpZGF0aW9uQ29uZmlnKSB7XHJcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHZhbGlkYXRpb25Db25maWcuaW5wdXRTZWxlY3RvcikpO1xyXG4gIGNvbnN0IGJ1dHRvbiA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IodmFsaWRhdGlvbkNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XHJcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xyXG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCkgPT4ge1xyXG4gICAgICBpc1ZhbGlkKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpO1xyXG4gICAgICBkaXNhYmxlZEJ1dHRvbihpbnB1dExpc3QsIGJ1dHRvbiwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZGlzYWJsZWRCdXR0b24oaW5wdXQsIGJ1dHRvbiwgdmFsaWRhdGlvbkNvbmZpZykge1xyXG4gIGlmIChjaGVja1ZhbGlkKGlucHV0KSkge1xyXG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKHZhbGlkYXRpb25Db25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodmFsaWRhdGlvbkNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhclZhbGlkYXRpb24oZm9ybUVsZW1lbnQsIHZhbGlkYXRpb25Db25maWcpIHtcclxuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodmFsaWRhdGlvbkNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XHJcbiAgY29uc3QgYnV0dG9uID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcih2YWxpZGF0aW9uQ29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcclxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgfSlcclxuICBkaXNhYmxlZEJ1dHRvbihpbnB1dExpc3QsIGJ1dHRvbiwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpIHtcclxuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh2YWxpZGF0aW9uQ29uZmlnLmZvcm1TZWxlY3RvcikpO1xyXG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qIFxyXG5cclxu0J/RgNC40LLQtdGCLCDRgNC10LLRjNC10Y7RgCA6KVxyXG5cclxu0K8g0LfQvdCw0Y4sINGH0YLQviDQvNC+0Lkg0LrQvtC0INC/0LvQvtGF0L7QuSwg0L3QviDRjywg0L/RgNCw0LLQtNCwLCDRgdGC0LDRgNCw0Y7RgdGMIVxyXG5cclxu0JfQtNC10YHRjCDRjyDQv9GA0L7RgdGC0L4g0L/QvtC30LTRgNCw0LLQu9GP0Y4g0JLQsNGBINGBINC90LDRgdGC0YPQv9Cw0Y7RidC40Lwg0L/RgNCw0LfQtNC90LjQutC+0LwsINGBINC90LDRgdGC0YPQv9Cw0Y7RidC40Lwg0L3QvtCy0YvQvCAyMDI0INCz0L7QtNC+0LwhXHJcbtCW0LXQu9Cw0Y4g0JLQsNC8INCy0YHQtdCz0L4g0YHQsNC80L7Qs9C+INC90LDQuNC70YPRh9GI0LXQs9C+LCDRh9C10LPQviDRgtC+0LvRjNC60L4g0LLQvtC30LzQvtC20L3QviA6KVxyXG5cclxu0JrRgdGC0LDRgtC4LCDQstC+0YIg0JLQsNC8INC10LvQutCwLCDQv9C+0LvRjNC30YPQudGC0LXRgdGMLiA6XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxMDEwMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAxMDEwMTAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgMTAxMDEwMTAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAxMDEwMTAxMDEwMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAxMDEwMTAxMDEwMTAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDBcclxuXHJcbiovIiwiaW1wb3J0ICcuL3N0eWxlcy9pbmRleC5jc3MnO1xyXG5pbXBvcnQgeyBjcmVhdGVDYXJkLCBoYW5kbGVMaWtlIH0gZnJvbSAnLi9jb21wb25lbnRzL2NhcmQuanMnO1xyXG5pbXBvcnQgeyBvcGVuTW9kYWwsIGNsb3NlTW9kYWwgfSBmcm9tICcuL2NvbXBvbmVudHMvbW9kYWwuanMnO1xyXG5pbXBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBjbGVhclZhbGlkYXRpb24gfSBmcm9tICcuL2NvbXBvbmVudHMvdmFsaWRhdGlvbi5qcyc7XHJcbmltcG9ydCB7IGdldEluZm8sIGdldENhcmRzLCBkZWxldGVDYXJkcywgdG9DaGFuZ2VBdmF0YXIsIHRvQ2hhbmdlTmFtZXMsIGFkZENhcmRzfSBmcm9tICcuL2NvbXBvbmVudHMvYXBpLmpzJztcclxuXHJcbi8vIHZhcmlhYmxlIG5hbWVzXHJcbmNvbnN0IGNhcmRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucGxhY2VzX19saXN0Jyk7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2ZpbGVfX2VkaXQtYnV0dG9uJyk7XHJcbmNvbnN0IHByb2ZpbGVCdXR0b25BZGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fYWRkLWJ1dHRvbicpO1xyXG5jb25zdCBwcm9maWxlSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9faW1hZ2UnKTtcclxuY29uc3QgYXZhdGFyUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2F2YXRhcicpO1xyXG5jb25zdCBpbnB1dExpbmtBdmF0YXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGluay1hdmF0YXItaW5wdXQnKTtcclxuY29uc3QgcG9wdXBEZWxldGVDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnBvcHVwX2RlbGV0ZS1pbWFnZScpO1xyXG5jb25zdCBwb3B1cERlbGV0ZUNhcmRCdXR0b24gPSBwb3B1cERlbGV0ZUNhcmQucXVlcnlTZWxlY3RvcignLnBvcHVwX19idXR0b24nKTtcclxuY29uc3QgcG9wdXBCdXR0b24gPSBhdmF0YXJQb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpO1xyXG5jb25zdCBuZXdDYXJkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfdHlwZV9uZXctY2FyZCcpO1xyXG5jb25zdCBpbWFnZU9wZW5Qb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2ltYWdlJyk7XHJcbmNvbnN0IGltYWdlUG9wdXBJbWFnZSA9IGltYWdlT3BlblBvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW1hZ2UnKTtcclxuY29uc3QgaW1hZ2VQb3B1cENhcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2NhcHRpb24nKVxyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9maWxlX190aXRsZScpO1xyXG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvZmlsZV9fZGVzY3JpcHRpb24nKTtcclxuY29uc3QgcG9wdXBQcm9maWxlRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF90eXBlX2VkaXQnKTtcclxuY29uc3QgcG9wdXBQcm9maWxlQnV0dG9uID0gcG9wdXBQcm9maWxlRWRpdC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpXHJcbmNvbnN0IGZvcm1Qcm9maWxlRWRpdCA9IHBvcHVwUHJvZmlsZUVkaXQucXVlcnlTZWxlY3RvcignLnBvcHVwX19mb3JtJyk7XHJcbmNvbnN0IGlucHV0TmFtZSA9IGZvcm1Qcm9maWxlRWRpdC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2lucHV0X3R5cGVfbmFtZScpO1xyXG5jb25zdCBpbnB1dERlc2NyaXB0aW9uID0gZm9ybVByb2ZpbGVFZGl0LnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW5wdXRfdHlwZV9kZXNjcmlwdGlvbicpO1xyXG5jb25zdCBhbGxQb3B1cHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucG9wdXAnKTtcclxuY29uc3QgY2FyZEJ1dHRvbiA9IG5ld0NhcmRQb3B1cC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX2J1dHRvbicpXHJcbmNvbnN0IGlucHV0UGxhY2VOYW1lRm9ybUFkZE5ld0NhcmQgPSBuZXdDYXJkUG9wdXAucXVlcnlTZWxlY3RvcignLnBvcHVwX19pbnB1dF90eXBlX2NhcmQtbmFtZScpO1xyXG5jb25zdCBpbnB1dFBsYWNlTGlua0Zvcm1BZGROZXdDYXJkID0gbmV3Q2FyZFBvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9faW5wdXRfdHlwZV91cmwnKTtcclxuY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcclxuICBmb3JtU2VsZWN0b3I6ICcucG9wdXBfX2Zvcm0nLFxyXG4gIGlucHV0U2VsZWN0b3I6ICcucG9wdXBfX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5wb3B1cF9fYnV0dG9uJyxcclxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiAncG9wdXBfX2J1dHRvbl9kaXNhYmxlZCcsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAncG9wdXBfX2lucHV0X3R5cGVfZXJyb3InLFxyXG4gIGVycm9yQ2xhc3M6ICdwb3B1cF9fZXJyb3JfdmlzaWJsZSdcclxufVxyXG5cclxuYWxsUG9wdXBzLmZvckVhY2goKG91dCkgPT4ge1xyXG4gIG91dC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKHt0YXJnZXQsIGN1cnJlbnRUYXJnZXR9KSA9PiB7IFxyXG4gICAgY29uc3QgaXNUYXJnZXRDbG9zZUJ1dHRvbiA9IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BvcHVwX19jbG9zZScpO1xyXG4gICAgY29uc3QgaXNUYXJnZXRPdmVybGF5ID0gdGFyZ2V0ID09PSBjdXJyZW50VGFyZ2V0O1xyXG4gICAgaWYgKGlzVGFyZ2V0Q2xvc2VCdXR0b24gfHwgaXNUYXJnZXRPdmVybGF5KSBjbG9zZU1vZGFsKG91dCk7XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuUHJvbWlzZS5hbGwoW2dldEluZm8oXCIvdXNlcnMvbWVcIiksIGdldENhcmRzKFwiL2NhcmRzXCIpXSlcclxuICAudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgY29uc3QgY3VycmVudFVzZXIgPSBkYXRhWzBdO1xyXG4gICAgY29uc3QgdXNlckNhcmRzID0gZGF0YVsxXS5maWx0ZXIoY2FyZCA9PiBjYXJkLm93bmVyLl9pZCA9PT0gY3VycmVudFVzZXIuX2lkKTtcclxuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gZGF0YVswXS5uYW1lO1xyXG4gICAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gZGF0YVswXS5hYm91dDtcclxuICAgIHByb2ZpbGVJbWFnZS5zdHlsZSA9IGBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJyR7ZGF0YVswXS5hdmF0YXJ9JylgXHJcbiAgICB1c2VyQ2FyZHMuZm9yRWFjaChjYXJkID0+IGNhcmRDb250YWluZXIuYXBwZW5kKGNyZWF0ZUNhcmQoY2FyZCwgcmVtb3ZlQ2FyZCwgb3BlbkltZywgaGFuZGxlTGlrZSwgY3VycmVudFVzZXIuX2lkKSkpXHJcbiAgfSlcclxuICAuY2F0Y2goKGVycikgPT4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke2Vyci5zdGF0dXN9YCkpO1xyXG5cclxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQoZXZ0KSB7IC8vIGZ1bmN0aW9uIHRoYXQgYWxsb3dzIGNoYW5naW5nIHRoZSBwcm9maWxlTmFtZSBhbmQgcHJvZmlsZURlc2NyaXB0aW9uIFxyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHNhdmVJbmZvKHRydWUsIHBvcHVwUHJvZmlsZUJ1dHRvbik7XHJcbiAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSBpbnB1dE5hbWUudmFsdWU7XHJcbiAgcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gaW5wdXREZXNjcmlwdGlvbi52YWx1ZTtcclxuICB0b0NoYW5nZU5hbWVzKGlucHV0TmFtZS52YWx1ZSwgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSlcclxuICAudGhlbigocmVzKSA9PiB7XHJcbiAgICBpZiAocmVzICYmIHJlcy5uYW1lICYmIHJlcy5hYm91dCkge1xyXG4gICAgICBwcm9maWxlTmFtZS50ZXh0Q29udGVudCA9IHJlcy5uYW1lO1xyXG4gICAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSByZXMuYWJvdXQ7XHJcbiAgICB9XHJcbiAgfSlcclxuICAuY2F0Y2goZXJyID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgc2F2ZUluZm8oZmFsc2UsIHBvcHVwUHJvZmlsZUJ1dHRvbik7XHJcbiAgICBjbG9zZU1vZGFsKHBvcHVwUHJvZmlsZUVkaXQpO1xyXG4gIH0pXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2F2ZUluZm8odHJ1ZSwgcG9wdXBCdXR0b24pO1xyXG4gIHRvQ2hhbmdlQXZhdGFyKGlucHV0TGlua0F2YXRhci52YWx1ZSlcclxuICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgcHJvZmlsZUltYWdlLnN0eWxlID0gYGJhY2tncm91bmQtaW1hZ2U6IHVybCgnJHtyZXMuYXZhdGFyfScpYFxyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4geyBcclxuICAgICAgc2F2ZUluZm8oZmFsc2UsIHBvcHVwQnV0dG9uKTtcclxuICAgICAgY2xvc2VNb2RhbChhdmF0YXJQb3B1cCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlQ2FyZFN1Ym1pdChldnQpIHsgLy8gZnVuY3Rpb24gdGhhdCBhZGRzIGEgbmV3IGNhcmQgdG8gdGhlIHBhZ2VcclxuICBldnQucHJldmVudERlZmF1bHQoKTtcclxuICBzYXZlSW5mbyh0cnVlLCBjYXJkQnV0dG9uKTtcclxuICBhZGRDYXJkcyhpbnB1dFBsYWNlTmFtZUZvcm1BZGROZXdDYXJkLnZhbHVlLCBpbnB1dFBsYWNlTGlua0Zvcm1BZGROZXdDYXJkLnZhbHVlKVxyXG4gICAgLnRoZW4oKGNhcmQpID0+IHtcclxuICAgICAgY2FyZENvbnRhaW5lci5hcHBlbmQoY3JlYXRlQ2FyZChjYXJkLCByZW1vdmVDYXJkLCBvcGVuSW1nLCBoYW5kbGVMaWtlLCBJRCkpXHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzYXZlSW5mbyhmYWxzZSwgY2FyZEJ1dHRvbik7XHJcbiAgICAgIGNsb3NlTW9kYWwobmV3Q2FyZFBvcHVwKTtcclxuICAgIH0pXHJcbiAgbmV3Q2FyZFBvcHVwLnF1ZXJ5U2VsZWN0b3IoJy5wb3B1cF9fZm9ybScpLnJlc2V0KCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoZXZ0KSB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2F2ZUluZm8odHJ1ZSwgcG9wdXBEZWxldGVDYXJkQnV0dG9uKTtcclxuICBjb25zdCBjYXJkSUQgPSBwb3B1cERlbGV0ZUNhcmRCdXR0b24uZGF0YXNldC5jYXJkSWQ7XHJcbiAgZGVsZXRlQ2FyZHMoY2FyZElEKVxyXG4gICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBkZWxldGVDYXJkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY2FyZElEKTtcclxuICAgICAgaWYgKGRlbGV0ZUNhcmQpIHtcclxuICAgICAgICBkZWxldGVDYXJkLnJlbW92ZSgpO1xyXG4gICAgICAgIHBvcHVwRGVsZXRlQ2FyZEJ1dHRvbi5kYXRhc2V0LmNhcmRJZCA9ICcnO1xyXG4gICAgICAgIHNhdmVJbmZvKGZhbHNlLCBwb3B1cERlbGV0ZUNhcmRCdXR0b24pO1xyXG4gICAgICAgIGNsb3NlTW9kYWwocG9wdXBEZWxldGVDYXJkKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIC5jYXRjaChlcnIgPT4gY29uc29sZS5sb2coZXJyKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHJlbW92ZUNhcmQoY2FyZCkge1xyXG4gIG9wZW5Nb2RhbChwb3B1cERlbGV0ZUNhcmQpO1xyXG4gIHBvcHVwRGVsZXRlQ2FyZEJ1dHRvbi5kYXRhc2V0LmNhcmRJZCA9IGNhcmRbJ19pZCddO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvcGVuSW1nKGRhdGEpIHtcclxuICBpbWFnZVBvcHVwSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xyXG4gIGltYWdlUG9wdXBDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xyXG4gIGltYWdlUG9wdXBJbWFnZS5zcmMgPSBkYXRhLmxpbms7XHJcbiAgb3Blbk1vZGFsKGltYWdlT3BlblBvcHVwKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIHNhdmVJbmZvKGxvYWQsIGJ1dHRvblRleHQpIHtcclxuICBpZiAobG9hZCkge1xyXG4gICAgYnV0dG9uVGV4dC50ZXh0Q29udGVudCA9ICfQodC+0YXRgNCw0L3QtdC90LjQtS4uLidcclxuICB9IGVsc2Uge1xyXG4gICAgYnV0dG9uVGV4dC50ZXh0Q29udGVudCA9IGJ1dHRvblRleHQuZGF0YXNldC5idXR0b25UZXh0O1xyXG4gIH1cclxufVxyXG5cclxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgaW5wdXROYW1lLnZhbHVlID0gcHJvZmlsZU5hbWUudGV4dENvbnRlbnQ7XHJcbiAgaW5wdXREZXNjcmlwdGlvbi52YWx1ZSA9IHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudDtcclxuICBjbGVhclZhbGlkYXRpb24ocG9wdXBQcm9maWxlRWRpdCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgb3Blbk1vZGFsKHBvcHVwUHJvZmlsZUVkaXQpO1xyXG59KTtcclxuXHJcbnByb2ZpbGVCdXR0b25BZGQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgY2xlYXJWYWxpZGF0aW9uKG5ld0NhcmRQb3B1cCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgb3Blbk1vZGFsKG5ld0NhcmRQb3B1cCk7XHJcbn0pO1xyXG5cclxucHJvZmlsZUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGlucHV0TGlua0F2YXRhci52YWx1ZSA9ICcnO1xyXG4gIGNsZWFyVmFsaWRhdGlvbihhdmF0YXJQb3B1cCwgdmFsaWRhdGlvbkNvbmZpZyk7XHJcbiAgb3Blbk1vZGFsKGF2YXRhclBvcHVwKTtcclxufSlcclxuXHJcbm5ld0NhcmRQb3B1cC5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBoYW5kbGVDYXJkU3VibWl0KTtcclxuZm9ybVByb2ZpbGVFZGl0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KTtcclxuYXZhdGFyUG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgaGFuZGxlQXZhdGFyU3VibWl0KTtcclxucG9wdXBEZWxldGVDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaGFuZGxlRGVsZXRlQ2FyZCk7XHJcblxyXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpOyJdLCJuYW1lcyI6WyJjb25maWciLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJwb3N0IiwidXNlcnMiLCJkYXRhIiwibWV0aG9kIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiZmV0Y2giLCJjb25jYXQiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJyZXMiLCJqc29uIiwiY2F0Y2giLCJlcnIiLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiY2FyZFRlbXBsYXRlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY29udGVudCIsImNyZWF0ZUNhcmQiLCJyZW1vdmVDYXJkIiwib3BlbkltZyIsImhhbmRsZUxpa2UiLCJJRCIsImNhcmRFbGVtZW50IiwiY2xvbmVOb2RlIiwiY2FyZERlbGV0ZUJ1dHRvbiIsImNhcmRJbWFnZSIsImNhcmRUaXRsZSIsImNhcmRMaWtlQnV0dG9uIiwiY2FyZExpa2VDb3VudCIsInNyYyIsImxpbmsiLCJhbHQiLCJuYW1lIiwidGV4dENvbnRlbnQiLCJsaWtlcyIsImFkZEV2ZW50TGlzdGVuZXIiLCJpZCIsInJlbW92ZSIsImNoZWNrIiwiY2xhc3NMaXN0IiwiYWRkIiwiY2FyZCIsImJ1dHRvbkxpa2UiLCJidXR0b25Db3VudCIsImhhbmRsZUxpa2VTdWNjZXNzIiwiaGFuZGxlTGlrZUVycm9yIiwiYWRkTGlrZSIsInRvZ2dsZSIsImNvbnNvbGUiLCJsb2ciLCJzb21lIiwiaSIsIm9wZW5Nb2RhbCIsInBvcHVwIiwiY2xvc2VFc2MiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImNvZGUiLCJjaGVja1ZhbGlkIiwiaW5wdXRMaXN0IiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsIl9yZWYyIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImVycm9yRWxlbWVudCIsImRpc2FibGVkQnV0dG9uIiwiYnV0dG9uIiwidmFsaWRhdGlvbkNvbmZpZyIsImRpc2FibGVkIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImNsZWFyVmFsaWRhdGlvbiIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJmb3JFYWNoIiwiY2FyZENvbnRhaW5lciIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZUJ1dHRvbkFkZCIsInByb2ZpbGVJbWFnZSIsImF2YXRhclBvcHVwIiwiaW5wdXRMaW5rQXZhdGFyIiwiZ2V0RWxlbWVudEJ5SWQiLCJwb3B1cERlbGV0ZUNhcmQiLCJwb3B1cERlbGV0ZUNhcmRCdXR0b24iLCJwb3B1cEJ1dHRvbiIsIm5ld0NhcmRQb3B1cCIsImltYWdlT3BlblBvcHVwIiwiaW1hZ2VQb3B1cEltYWdlIiwiaW1hZ2VQb3B1cENhcHRpb24iLCJwcm9maWxlTmFtZSIsInByb2ZpbGVEZXNjcmlwdGlvbiIsInBvcHVwUHJvZmlsZUVkaXQiLCJwb3B1cFByb2ZpbGVCdXR0b24iLCJmb3JtUHJvZmlsZUVkaXQiLCJpbnB1dE5hbWUiLCJpbnB1dERlc2NyaXB0aW9uIiwiYWxsUG9wdXBzIiwiY2FyZEJ1dHRvbiIsImlucHV0UGxhY2VOYW1lRm9ybUFkZE5ld0NhcmQiLCJpbnB1dFBsYWNlTGlua0Zvcm1BZGROZXdDYXJkIiwiZm9ybVNlbGVjdG9yIiwic2F2ZUluZm8iLCJsb2FkIiwiYnV0dG9uVGV4dCIsImRhdGFzZXQiLCJvdXQiLCJfcmVmIiwidGFyZ2V0IiwiY3VycmVudFRhcmdldCIsImNvbnRhaW5zIiwiYWxsIiwiY3VycmVudFVzZXIiLCJ1c2VyQ2FyZHMiLCJmaWx0ZXIiLCJvd25lciIsIl9pZCIsImFib3V0Iiwic3R5bGUiLCJhdmF0YXIiLCJhcHBlbmQiLCJ2YWx1ZSIsImRhdGFOYW1lIiwiZGF0YUxpbmsiLCJwcmV2ZW50RGVmYXVsdCIsImZpbmFsbHkiLCJyZXNldCIsInRvQ2hhbmdlTmFtZXMiLCJhdmF0YXJMaW5rIiwiY2FyZElkIiwiY2FyZElEIiwiZGVsZXRlQ2FyZCIsInBhdHRlcm5NaXNtYXRjaCIsInNldEN1c3RvbVZhbGlkaXR5IiwiZXJyb3JNZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImlzVmFsaWQiLCJzZXRFdmVudExpc3RlbmVycyIsImVuYWJsZVZhbGlkYXRpb24iXSwic291cmNlUm9vdCI6IiJ9